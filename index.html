<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>A Bit of Focus</title>
    <link rel="stylesheet" href="assets/css/dark.css">
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/icon-32x32.png">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon.ico" type="image/x-icon">

    <!-- ios support -->
    <link rel="apple-touch-icon" href="assets/images/icon-32x32.png" />
    <link rel="apple-touch-icon" href="assets/images/icon-72x72.png" />
    <link rel="apple-touch-icon" href="assets/images/icon-96x96.png" />
    <link rel="apple-touch-icon" href="assets/images/icon-128x128.png" />
    <link rel="apple-touch-icon" href="assets/images/icon-144x144.png" />
    <link rel="apple-touch-icon" href="assets/images/icon-152x152.png" />
    <link rel="apple-touch-icon" href="assets/images/icon-192x192.png" />
    <link rel="apple-touch-icon" href="assets/images/icon-512x512.png" />

    <meta name="apple-mobile-web-app-status-bar" content="#ffaa00" />
    <meta name="theme-color" content="#ffaa00" />

</head>
<body>


    <div id="alert">
        <p>This webpage would like to play sounds</p>
        <p class="buttons">
            <button value="0">Block</button>
            <button value="1">Allow</button>
        </p>
    </div>



    <header>
        <h1><a href="https://volta-tools.github.io/bit-of-focus/"><img src="assets/images/icon-32x32.png" alt="logo"></a> A Bit of Focu<button id="triggerNotificationButton">s</button></h1>
    </header>

    <main>
        <div id="timer"></div>
        <div id="timerMessage"></div>


    </main>

    <footer>
        <div><strong>&copy; Copyright:</strong> 2024 Bit Academy</div>
        <div><strong>Author:</strong>Rob Demmenie</div>
        <div><strong>Email:</strong> rob@bitacademy.nl</div>
    </footer>

    <script src="assets/js/app.js"></script>
    <script type="module">
        import  BitTimer from "./assets/js/BitTimer.mjs";

        const audio = new Audio( '/assets/audio/simple-notification.mp3' );
        const alertElement = document.getElementById( 'alert' );
        audio.muted = true;
        audio.play().then( () => {
            alertElement.remove();   // already allowed
            resetAudio();
        }).catch( () => {
            // need user interaction
            alertElement.addEventListener( 'click', ({ target }) => {
                if( target.matches('button') ) {
                    const allowed = target.value === "1";
                    if( allowed ) audio.play().then( resetAudio );
                    alertElement.remove();
                }
            });
        });

        document.getElementById( 'triggerNotificationButton' ).addEventListener( 'click', (e) => {
            if( audio.muted )   console.log( 'silent notification' );
            else  audio.play();
        } );

        function resetAudio() {
            audio.pause();
            audio.currentTime = 0;
            audio.muted = false;
        }

        fetch('api/v1/config.json').then((result) => {
            result.json().then((config) => {
                console.debug( config );
                const CLOCK = new BitTimer(config);
                CLOCK.start();
            }).catch(error => {
                console.debug("Parsing error", error);
            });
        }).catch(error => {
            console.debug("Failed to fetch", error);
        });

    </script>

</body>
</html>